# kintoneカスタマイズの要件

## 機能

### 一覧画面

- 一覧画面では、以下の情報を表示する。
  - サイトの名前
  - URL
  - ユーザー名
  - パスワード
  - ワンタイムパスワード

- サイトの名前をクリックすると、詳細画面に遷移する。

- URLをクリックすると、そのURLにワイルドカードが使われていない場合は新しいタブでそのURLを開く。
  - ワイルドカードが使われている場合は、クリックしても何も起こらない。

- ユーザー名、パスワード、ワンタイムパスワードを右クリックすると、「コピーしました」というメッセージを表示し、クリップボードにコピーする。

### 詳細画面

- 詳細画面では、以下の情報を表示する。
  - サイトの名前
  - URL
  - ユーザー名
  - パスワード
  - ワンタイムパスワード

- いずれの値も、クリックすると「コピーしました」というメッセージを表示し、クリップボードにコピーする。

### 登録画面 / 編集画面

- 登録画面および編集画面（以下まとめて登録画面と呼ぶ）では、以下の情報を入力するフィールドがある。
  - サイトの名前
  - URL（ワイルドカード(`*`)を含む）
  - ユーザー名
  - パスワード
  - OTPAuth URI（オプション）

- OTPAuth URIは以下の4通りの方法で登録できる。
  - カメラでQRコードを読み取る。
  - ファイルからQRコードの画像を読み取る。
  - クリップボードからQRコードの画像またはOTPAuth URIを読み取る。
  - 手動でOTPAuth URIを入力する。

- 登録画面を開いたときに、パスワードとOTPAuth URIを復号して表示する。
  - パスフレーズがlocalStorageに表示されていない場合は、入力を促すダイアログを表示する。
  - ダイアログへの入力がキャンセルされた場合は、パスワードとOTPAuth URIはグレーアウトした状態で表示される。

- 登録画面の「保存」ボタンをクリックすると、パスワードとOTPAuth URIは暗号化してkintoneに保存される。

### パスワードとワンタイムパスワードの表示

一覧画面と詳細画面では、パスワードとワンタイムパスワードは以下の条件で表示する。

- パスフレーズがlocalStorageに保存されていない場合、パスワードとワンタイムパスワードは表示されない。代わりに、「表示」というボタンが表示される。
  - このボタンをクリックすると、パスフレーズの入力を求めるダイアログが表示される。
  - 正しいパスフレーズが入力された場合、パスワードとワンタイムパスワードが表示される。パスフレーズはlocalStorageに保存される。

- パスフレーズがlocalStorageに保存されている場合は以下の挙動になる。
  - パスワードはデフォルトでは黒塗りの状態で表示され、マウスオーバーすると黒塗りが解除される。
  - HOTP形式のワンタイムパスワードは表示されず「表示」というボタンだけが表示される。
    - このボタンをクリックすると、最新のワンタイムパスワードを計算して表示する。
    - 表示すると同時にOTPAuth URIに含まれているcounterの値を1増やして、kintoneに保存しなおす。
  - TOTP形式のワンタイムパスワードは、常に最新の値が表示される。
    - ワンタイムパスワードの下にはプログレスバーが表示され、残り時間を示す。

- 保存されたパスフレーズで暗号化データの復号に失敗した場合、localStorageからパスフレーズを自動的に削除する。
  - この場合、パスワードとワンタイムパスワードは表示されず、「表示」ボタンが表示される状態に戻る。
  - ユーザーは再度正しいパスフレーズを入力する必要がある。


## セキュリティ

- パスワードとOTPAuth URIは、kintoneに保存する際にパスフレーズを使用して暗号化する。
  - 暗号化の仕様は[encryption.md](encryption.md)を参照。

- パスフレーズはlocalStorageに保存され、暗号化されたパスワードとOTPAuth URIを復号化するために使用される。


## デザイン

- kintoneのデザインに合わせたシンプルなデザインとする。


## 動作環境とバージョン

- Google Chromeの最新版のみをサポート対象とする。

- 実装をシンプルに保つために、可能な限り最新の機能を使用する。
